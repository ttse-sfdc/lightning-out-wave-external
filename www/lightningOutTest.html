<html>
	<script
		src="https://code.jquery.com/jquery-3.2.1.min.js"
		integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
		crossorigin="anonymous"></script>
	<script src="https://externalwavetest.my.salesforce.com/lightning/lightning.out.js"></script>

	<script>
		$.noConflict();

		var url = 'https://externalwavetest.lightning.force.com';
		
		jQuery( document ).ready(function( $ ) {
			var accessToken = location.hash.split("=")[1];
			console.warn("Access Token: " + accessToken);
			
			$Lightning.use("wave:WaveApp", function(evt) {
				$Lightning.createComponent(
					"wave:waveDashboard", 
					{
						dashboardId: "0FKB00000002DdXOAU",
						height: "900",
	          showSharing: false
					},
					"waveCmp",
					function(cmp,msg,err) {
						console.warn("Wave Dashboard Ready: ", cmp, msg, err);
					}
				);
			}, url, accessToken);

			jQuery("#filterButton").click(function () {
				console.log("Filter Button Clicked");
				sendFilter();
			});

			jQuery("#selectionButton").click(function () {
				console.log("Selection Button Clicked");
				sendSelection();
			});

			jQuery("#resetButton").click(function () {
				console.log("Reset Button Clicked");
				sendReset();
			});

			jQuery("#navButton").click(function () {
				console.log("Nav Button Clicked");
				jQuery("#waveCmp").empty();
				$Lightning.createComponent(
					"wave:waveDashboard", 
					{
						dashboardId: "0FKB00000005nruOAA",
						height: "900",
	          showSharing: false
					},
					"waveCmp",
					function(cmp,msg,err) {
						console.warn("Wave Dashboard Ready: ", cmp, msg, err);
					}
				);
			});
		});

		sendSelection = function(){
			var selection = JSON.stringify({
        "datasets": {
            "opportunity1": [
                {
                    "fields": ["Product.Product.Family"],
                    "selection": ["Product"]
                }                    
            ]
        }            
	    });
	    
	    console.warn("selection: ", selection);
	                     
	    var evt = $A.get("e.wave:update");
	    console.warn("evt: ", evt);
	    
	    var params = {
	        value: selection,
	        id: "0FKB00000002DdXOAU",
	        type: "dashboard"                        
	    };
	    
	    console.warn("param: ", params);
	    
	    evt.setParams(params);	    
	    evt.fire();            
		}

		sendFilter = function () {
      var filterJson = JSON.stringify({
      	"datasets": {
          "opportunity1": [
              {
                  "fields": ["Product.Product.Family"],
                  "filter": {
                       "operator": "matches",
                       "values": ["Product"]
                  }
              }
          ]
        }
      });
      
      var evt = $A.get("e.wave:update");
      console.warn("evt: ", evt);
      
      var params = {
          value: filterJson,
          id: "0FKB00000002DdXOAU",
          type: "dashboard"                        
      };
      
      console.warn("param: ", params);
      
      evt.setParams(params);      
      evt.fire();            
		}

		sendReset = function () {
      var filterJson = JSON.stringify()
      
      var evt = $A.get("e.wave:update");
      console.warn("evt: ", evt);
      
      var params = {
          value: filterJson,
          id: "0FKB00000002DdXOAU",
          type: "dashboard"                        
      };
      
      console.warn("param: ", params);
      
      evt.setParams(params);      
      evt.fire();            
		}
	</script>

	<head>
		<style>
			#header { 
				background-color: white;
				width: 100%;
				height: 65px;
				 position: absolute;
				top: 50px;
			  left: 0;
			  z-index: 10;
			}
			#waveCmp {
				width: 100%;
				height: 100%;
				top: 50px;
			  left: 0;
			  position: absolute;
			}
		</style>

		<meta http-equiv="Content-Language" content="en-us">
		<meta http-equiv="Content-Type" content="text/html;">
		<title>Wave External Test</title>
	</head>
	<body>
		<div id='header'>
			<button id='filterButton'>FILTER</button>
			<button id='selectionButton'>SELECTION</button>
			<button id='resetButton'>RESET</button>
			<button id="navButton">CHANGE DB</button>
			<div id="listview"></div>
		</div>		
		<div id='waveCmp'></div>
	</body>
</html>